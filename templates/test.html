<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>간단한 지도 표시하기</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=lqj4d734cm"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=lqj4d734cm&submodules=panorama"></script>
</head>
<body>
    <div id="button-container">
        <button id="street">거리뷰</button>
    </div>
    <div id="map" style="width:65%;height:760px"></div>
    <div id="pano" style="width: 65%;height: 300px;"></div>

<script>
var HOME_PATH = window.HOME_PATH || '.';

var map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(37.2856373, 127.0345859),
    zoom: 17
});

var pano = null;
naver.maps.onJSContentLoaded = function() {
    pano = new naver.maps.Panorama("pano", {
        position: new naver.maps.LatLng(37.2856373, 127.0345859),
        pov: {
            pan: -133,
            tilt: 0,
            fov: 100
        }
    });

    naver.maps.Event.addListener(pano, 'pano_changed', function() {
        var latlng = pano.getPosition();
        if (!latlng.equals(map.getCenter())) {
            map.setCenter(latlng);
        }
    });
};

var streetLayer = new naver.maps.StreetLayer();
naver.maps.Event.once(map, 'init', function() {
    streetLayer.setMap(map);
});

var btn = $('#street');
var markers = [];

// 더미 데이터
var latlngs = [
    new naver.maps.LatLng(37.2856373, 127.0345859),
    new naver.maps.LatLng(37.2856373, 127.0355859),
    new naver.maps.LatLng(37.2856373, 127.0365859)
];

btn.on("click", function(e) {
    e.preventDefault();
    if (streetLayer.getMap()) {
        streetLayer.setMap(null);
        for (var i = 0, ii = latlngs.length; i < ii; i++) {
            var marker = createMarker(latlngs[i]);
            markers.push(marker);
        }
    } else {
        streetLayer.setMap(map);
        hideMarkers();
    }
});

naver.maps.Event.addListener(map, 'streetLayer_changed', function(streetLayer) {
    if (streetLayer) {
        btn.addClass('control-on');
        showMarkersOnHover();
    } else {
        btn.removeClass('control-on');
        hideMarkers();
    }
});

naver.maps.Event.addListener(map, 'click', function(e) {
    if (streetLayer.getMap()) {
        var latlng = e.coord;
        pano.setPosition(latlng);
    }
});

function createMarker(position) {
    var marker = new naver.maps.Marker({
        position: position,
        map: map
    });

    var infoWindow = new naver.maps.InfoWindow({
        content: '<div style="width:150px;text-align:center;padding:10px;">Marker at (' + position.lat() + ', ' + position.lng() + ')</div>',
        disableAutoPan: true
    });

    markers.push({ marker: marker, infoWindow: infoWindow });

    naver.maps.Event.addListener(marker, 'mouseover', function() {
        infoWindow.open(map, marker);
    });

    naver.maps.Event.addListener(marker, 'mouseout', function() {
        infoWindow.close();
    });

    return marker;
}

function showMarkersOnHover() {
    for (var i = 0; i < markers.length; i++) {
        var marker = markers[i].marker;
        naver.maps.Event.addListener(marker, 'mouseover', (function(marker) {
            return function() {
                marker.infoWindow.open(map, marker);
            };
        })(marker));

        naver.maps.Event.addListener(marker, 'mouseout', (function(marker) {
            return function() {
                marker.infoWindow.close();
            };
        })(marker));
    }
}

function hideMarkers() {
    for (var i = 0; i < markers.length; i++) {
        markers[i].marker.setMap(null);
    }
}
</script>
</body>
</html>
